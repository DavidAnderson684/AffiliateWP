jQuery(document).ready(function(a){function c(){var b=a("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,c=a("#affiliate-wp-migrate-user-accounts input[type=submit]");b>0?c.prop("disabled",!1):c.prop("disabled",!0)}var b;window.formfield="",a("body").on("click",".affwp_settings_upload_button",function(c){c.preventDefault();var d=a(this);return window.formfield=a(this).parent().prev(),b?void b.open():(b=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:d.data("uploader_title"),button:{text:d.data("uploader_button_text")},multiple:!1}),b.on("menu:render:default",function(a){var b={};a.unset("library-separator"),a.unset("gallery"),a.unset("featured-image"),a.unset("embed"),a.set(b)}),b.on("insert",function(){var a=b.state().get("selection");a.each(function(a,b){a=a.toJSON(),window.formfield.val(a.url)})}),void b.open())});var b;window.formfield="",a(".affwp-referrals-export-toggle").click(function(){a(".affwp-referrals-export-toggle").toggle(),a("#affwp-referrals-export-form").slideToggle()}),a(".affwp-datepicker").length&&a(".affwp-datepicker").datepicker({dateFormat:"mm/dd/yy"}),a(".affwp-user-search").each(function(){var b=a(this),c="affwp_search_users",d=b.val(),e=b.data("affwp-status");b.autocomplete({source:ajaxurl+"?action="+c+"&term="+d+"&status="+e,delay:500,minLength:2,position:{offset:"0, -1"},open:function(){b.addClass("open")},close:function(){b.removeClass("open")}})});var b;a("body").on("click",".upload_image_button",function(c){c.preventDefault();var d=a(this).prev();return b?void b.open():(b=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}}),b.on("menu:render:default",function(a){var b={};a.unset("library-separator"),a.unset("gallery"),a.unset("featured-image"),a.unset("embed"),a.set(b)}),b.on("select",function(){var c=b.state().get("selection").first().toJSON();d.val(c.url);var e=a("<img />");e.attr("src",c.url),a("#preview_image").empty().append(e),a("#preview_image img")&&a("#preview_image").show()}),void b.open())}),a("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(a){return!!confirm(affwp_vars.confirm_delete_referral)}),c(),a("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){c()}),a("#affwp_add_affiliate #status").change(function(){var b=a(this).val();"active"==b?a("#affwp-welcome-email-row").show():(a("#affwp-welcome-email-row").hide(),a("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),"undefined"!=typeof postboxes&&postboxes.add_postbox_toggles(pagenow);var d={init:function(){this.submit(),this.dismiss_message()},submit:function(){var b=this,c=a(".affwp-batch-form");c.on("submit",function(c){c.preventDefault();var d=a(this).find('input[type="submit"]');if(!d.hasClass("button-disabled")){var e=a(this).data("ays");if(void 0!==e&&!confirm(e))return;var f={batch_id:a(this).data("batch_id"),nonce:a(this).data("nonce"),form:a(this).serializeAssoc()};d.addClass("button-disabled"),a(this).find(".notice-wrap").remove(),a(this).append('<div class="notice-wrap"><div class="affwp-batch-progress"><div></div></div></div>'),d.parent().append('<span class="spinner is-active"></span>'),b.process_step(1,f,b)}})},process_step:function(b,c,d){a.ajax({type:"POST",url:ajaxurl,data:{batch_id:c.batch_id,action:"process_batch_request",nonce:c.nonce,form:c.form,step:b},dataType:"json",success:function(b){if(b.data.done||b.data.error){var e=a(".affwp-batch-form").find(".affwp-batch-progress").parent().parent(),f=e.find(".spinner"),g=e.find(".notice-wrap");e.find(".button-disabled").removeClass("button-disabled"),b.data.error?(f.remove(),g.html('<div class="updated error"><p>'+b.data.error+"</p></div>")):b.data.done?(f.remove(),g.html('<div id="affwp-batch-success" class="updated notice is-dismissible"><p>'+b.data.message+'<span class="notice-dismiss"></span></p></div>'),b.data.url&&(window.location=b.data.url)):g.remove()}else a(".affwp-batch-progress div").animate({width:b.data.percentage+"%"},50,function(){}),d.process_step(parseInt(b.data.step),c,d)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},dismiss_message:function(){a("body").on("click","#affwp-batch-success .notice-dismiss",function(){a("#affwp-batch-success").parent().slideUp("fast")})}};d.init(),a.extend({isArray:function(a){return"object"==typeof a&&a.constructor==Array},arrayMerge:function(){for(var b={},c=0,d=a.arrayMerge.arguments,e=0;e<d.length;e++)if(a.isArray(d[e])){for(var f=0;f<d[e].length;f++)b[c++]=d[e][f];b=a.makeArray(b)}else for(var g in d[e])if(isNaN(g)){var h=d[e][g];"object"==typeof h&&b[g]&&(h=a.arrayMerge(b[g],h)),b[g]=h}else b[c++]=d[e][g];return b},count:function(b){if(a.isArray(b))return b.length;var c=0;for(var d in b)isNaN(d)||c++;return c}}),a.fn.extend({serializeAssoc:function(){for(var b={aa:{},add:function(b,c){var d=b.match(/^(.*)\[([^\]]*)\]$/);if(d){var e={};d[2]?e[d[2]]=c:e[a.count(e)]=c,this.add(d[1],e)}else"object"==typeof c?("object"!=typeof this.aa[b]&&(this.aa[b]={}),this.aa[b]=a.arrayMerge(this.aa[b],c)):this.aa[b]=c}},c=a(this).serializeArray(),d=0;d<c.length;d++)b.add(c[d].name,c[d].value);return b.aa}})});